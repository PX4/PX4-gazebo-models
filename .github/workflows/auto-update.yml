name: Auto Update

on:
    workflow_dispatch:
    push:
      branches:
        - main

jobs:
    update:
        runs-on: ubuntu-latest

    steps:
        -name: Checkout code
        uses: actions/checkout@v2

        -name: Accept OSRF software and set up gz fuel tools
        run: |
            sudo sh -c 'echo "deb http://packages.osrfoundation.org/gazebo/ubuntu-stable `lsb_release -cs` main" > /etc/apt/sources.list.d/gazebo-stable.list'
            wget http://packages.osrfoundation.org/gazebo.key -O - | sudo apt-key add -
            sudo apt-get update
            sudo apt-get install libgz-tools2-dev

        -name: Get latest commit hash
        run: latest_commit=$(git rev-parse main)

        -name: Get second-to-last commit hash
        run: second_to_last_commit=$(git rev-parse HEAD)

        -name: Update Fuel Models
        run: ./diff.sh $second_to_last_commit $latest_commit ${{ secrets.GAZEBO_FUEL_TOKEN }}
